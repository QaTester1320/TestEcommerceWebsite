<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA Test Store</title>
    <!-- Custom CSS Only - No Tailwind or external frameworks -->
    <style>
        :root {
            --primary-color: #0a4a91;
            --secondary-color: #007bff;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --border-color: #dee2e6;
            --shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            background-color: #f4f7f6;
            color: var(--dark-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 0;
        }

        /* --- Header & Navigation --- */
        .site-header {
            background-color: #ffffff;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            gap: 1.5rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            flex-shrink: 0;
        }

        /* --- Search Bar --- */
        .search-form {
            display: flex;
            flex-grow: 1;
            max-width: 500px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .search-form input {
            flex-grow: 1;
            border: none;
            padding: 0.6rem 1rem;
            font-size: 1rem;
            outline: none;
        }
        
        .search-form button {
            background-color: var(--primary-color);
            border: none;
            color: white;
            padding: 0 1.2rem;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .search-form button:hover {
            background-color: var(--secondary-color);
        }
        /* --- End Search Bar --- */

        .main-nav ul {
            list-style: none;
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .main-nav a {
            text-decoration: none;
            color: var(--dark-color);
            font-weight: 500;
            font-size: 1rem;
            padding: 0.5rem;
            border-radius: 6px;
            transition: background-color 0.3s, color 0.3s;
        }

        .main-nav a:hover,
        .main-nav a.active {
            color: #ffffff;
            background-color: var(--primary-color);
        }
        
        .nav-icon-link {
            font-size: 1.2rem;
        }
        
        /* --- Mini Cart --- */
        .mini-cart {
            position: relative;
            cursor: pointer;
        }
        
        .mini-cart-icon {
            font-size: 1.5rem;
            position: relative;
            padding: 0.5rem;
        }
        
        #cart-count {
            position: absolute;
            top: 0px;
            right: 0px;
            background-color: var(--danger-color);
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 0.75rem;
            font-weight: 700;
            display: none; /* Hidden by default */
        }
        
        .mini-cart-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            width: 320px;
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            padding: 1rem;
            z-index: 1001;
            display: none;
        }
        
        .mini-cart.open .mini-cart-dropdown {
            display: block;
        }
        
        #mini-cart-items {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }
        
        .mini-cart-item {
            display: flex;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .mini-cart-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 6px;
        }
        
        .mini-cart-item-info {
            flex-grow: 1;
        }
        
        .mini-cart-item-info .name {
            font-weight: 600;
        }
        
        .mini-cart-summary {
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
            margin-bottom: 1rem;
        }
        
        .mini-cart-summary .subtotal {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }
        
        .mini-cart-actions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .mini-cart-actions .btn {
            width: 100%;
            text-align: center;
        }

        /* --- Main Content & Pages --- */
        main {
            flex-grow: 1;
        }

        .page {
            padding: 2rem 0;
        }

        .hidden {
            display: none;
        }

        h1, h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        h3.section-title {
            font-size: 1.8rem;
            color: var(--dark-color);
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 0.5rem;
            margin-bottom: 2rem;
            margin-top: 2rem;
        }
        
        h4.form-section-title {
            font-size: 1.4rem;
            color: var(--dark-color);
            margin-top: 2rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        /* --- Home Page --- */
        .hero {
            background-color: var(--primary-color);
            color: white;
            padding: 4rem 2rem;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 2rem;
        }
        .hero h1 {
            color: white;
            font-size: 2.5rem;
        }
        .hero p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }
        .cta-button {
            background-color: var(--success-color);
            color: white;
            padding: 0.8rem 1.5rem;
            font-size: 1.1rem;
            font-weight: 600;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }
        .cta-button:hover {
            background-color: #218838;
            transform: translateY(-2px);
        }

        /* Homepage Slider */
        .slider-container {
            position: relative;
            max-width: 100%;
            margin: 2rem auto;
            overflow: hidden;
            border-radius: 12px;
            box-shadow: var(--shadow);
            background-color: #000;
        }
        
        .slider {
            display: flex;
            transition: transform 0.5s ease-in-out;
        }

        .slide {
            min-width: 100%;
            position: relative;
        }

        .slide img {
            width: 100%;
            height: 400px;
            object-fit: cover;
            display: block;
            opacity: 0.7;
        }

        .slide-content {
            position: absolute;
            bottom: 40px;
            left: 40px;
            color: white;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .slide-content h3 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .slider-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 1rem;
        }

        .slider-nav button {
            background-color: rgba(255, 255, 255, 0.7);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .slider-nav button:hover {
            background-color: white;
        }

        /* --- Products Page --- */
        .product-page-layout {
            display: flex;
            gap: 2rem;
        }
        
        .filter-sidebar {
            flex: 0 0 250px; /* Sidebar width */
            background-color: #ffffff;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            align-self: flex-start;
        }
        
        .filter-sidebar h3 {
            font-size: 1.3rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }
        
        .filter-group {
            margin-bottom: 1.5rem;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .filter-group .filter-option {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .filter-group .filter-option input {
            margin-right: 0.5rem;
        }
        
        .filter-group input[type="number"] {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .price-filter-inputs {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .filter-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .product-grid-container {
            flex: 1;
        }
        
        #product-grid, #category-product-grid, #wishlist-grid, #featured-products, #bestseller-products, #related-products {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }

        .product-card {
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s, box-shadow 0.3s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        
        .product-card-icons {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
            z-index: 10;
        }
        
        .product-card-icon {
            background-color: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: var(--dark-color);
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }
        .product-card-icon:hover {
            background-color: var(--primary-color);
            color: white;
        }
        .product-card-icon.active {
            background-color: var(--danger-color);
            color: white;
        }

        .product-image {
            width: 100%;
            height: 200px;
            overflow: hidden;
        }
        .product-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }

        .product-info h3 {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--dark-color);
        }

        .product-info .product-price {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1rem;
        }

        .product-info .product-desc-short {
            font-size: 0.95rem;
            margin-bottom: 1.5rem;
            flex-grow: 1;
        }
        
        .product-actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .btn {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
            font-weight: 600;
            text-decoration: none;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, box-shadow 0.2s;
            text-align: center;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
            flex-grow: 1;
        }
        .btn-primary:hover {
            background-color: #0069d9;
            box-shadow: 0 4px 8px rgba(0,123,255,0.3);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
            border: 1px solid var(--border-color);
            flex-grow: 1;
        }
        .btn-secondary:hover {
            background-color: #e2e6ea;
        }
        
        .btn-warning {
             background-color: var(--warning-color);
             color: var(--dark-color);
        }
         .btn-warning:hover {
             background-color: #e0a800;
         }
        
        /* --- Category Page --- */
        #category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
        }
        
        .category-card {
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            text-decoration: none;
            color: var(--dark-color);
            transition: transform 0.3s, box-shadow 0.3s;
            text-align: center;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
        }
        .category-image {
            width: 100%;
            height: 180px;
            overflow: hidden;
        }
        .category-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .category-info {
            padding: 1.5rem;
        }
        .category-info h3 {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        /* --- Product Detail Page --- */
        #product-detail-content {
            display: flex;
            gap: 2rem;
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 3rem;
        }

        .product-detail-image {
            flex: 1;
            max-width: 400px;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
        }
        
        .product-detail-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-detail-info {
            flex: 2;
        }

        #detail-name {
            font-size: 2.5rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }

        #detail-price {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
        }
        
        #detail-sku {
            font-size: 1rem;
            font-weight: 600;
            color: #6c757d;
            margin-bottom: 1.5rem;
        }

        #detail-desc {
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }
        
        .quantity-control {
            margin-bottom: 1.5rem;
        }
        
        .quantity-control-inner {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .quantity-control-inner label {
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .quantity-control-inner input {
            width: 60px;
            padding: 0.5rem;
            font-size: 1.1rem;
            text-align: center;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .field-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            display: none; /* Hidden by default */
        }
        
        .detail-actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* --- Cart Page --- */
        #cart-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1.5rem;
            background-color: #ffffff;
            box-shadow: var(--shadow);
            border-radius: 12px;
            overflow: hidden;
        }

        #cart-table th, #cart-table td {
            padding: 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        #cart-table th {
            background-color: var(--light-color);
            font-size: 1rem;
            text-transform: uppercase;
            color: var(--dark-color);
        }
        
        #cart-table td {
            vertical-align: middle;
        }
        
        .cart-item-name {
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .cart-item-quantity {
            width: 120px;
        }

        .cart-item-quantity input {
            width: 50px;
            padding: 0.4rem;
            text-align: center;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .cart-item-quantity .field-error {
            font-size: 0.8rem;
            margin-top: 4px;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
            font-size: 0.9rem;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }

        #cart-empty-message {
            text-align: center;
            font-size: 1.2rem;
            padding: 3rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        #cart-empty-message p {
            margin-bottom: 1.5rem;
        }
        
        .cart-summary {
            display: flex;
            justify-content: flex-end;
            margin-top: 2rem;
        }
        
        .cart-summary-box {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
        }
        
        .cart-summary-box h2 {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }
        
        .summary-line {
            display: flex;
            justify-content: space-between;
            font-size: 1.1rem;
            margin-bottom: 1rem;
        }
        
        .summary-line span:last-child {
            font-weight: 600;
        }
        
        .summary-line.discount {
            color: var(--success-color);
        }
        
        .summary-line.grand-total {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
            border-top: 2px solid var(--border-color);
            padding-top: 1rem;
            margin-top: 1rem;
        }
        
        .coupon-form {
            display: flex;
            gap: 10px;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1.5rem;
        }
        .coupon-form input {
            flex-grow: 1;
            padding: 0.6rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        
        .checkout-button {
            display: block;
            width: 100%;
            text-align: center;
            margin-top: 1.5rem;
        }

        /* --- Login/Account Pages --- */
        .form-container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
            max-width: 500px;
            margin: 2rem auto;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background-color: white; /* for select */
        }
        
        .form-group input.invalid,
        .form-group textarea.invalid,
        .form-group select.invalid {
            border-color: var(--danger-color);
        }
        
        .form-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 0.25rem;
            display: none;
        }
        
        .form-container p {
            text-align: center;
        }
        
        .form-container p a {
            color: var(--secondary-color);
            font-weight: 600;
            text-decoration: none;
        }
        .form-container p a:hover {
            text-decoration: underline;
        }
        
        .account-page-box {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        .account-page-box ul {
            list-style: none;
            margin-bottom: 2rem;
        }
        
        .account-page-box ul li {
            margin-bottom: 1rem;
        }
        
        .account-page-box ul li a {
            text-decoration: none;
            color: var(--secondary-color);
            font-size: 1.2rem;
            font-weight: 500;
        }
         .account-page-box ul li a:hover {
             text-decoration: underline;
         }
         
        /* --- Compare Page --- */
        #compare-table-container {
            overflow-x: auto;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        .compare-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        .compare-table th, .compare-table td {
            border: 1px solid var(--border-color);
            padding: 1.5rem;
            text-align: left;
            vertical-align: top;
        }
        .compare-table th {
            background-color: var(--light-color);
            font-size: 1.1rem;
        }
        .compare-table thead th:first-child {
            background-color: var(--dark-color);
            color: white;
            font-size: 1.3rem;
        }
        .compare-table tbody th {
            font-weight: 700;
            width: 150px;
        }
        .compare-table .compare-image {
            width: 150px;
            height: 150px;
            object-fit: cover;
            margin: 0 auto;
            display: block;
        }
        .compare-table .compare-price {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        .compare-table .compare-desc {
            font-size: 0.95rem;
            min-height: 100px;
        }

        /* --- Order Success Page --- */
        #order-success-message {
            text-align: center;
            padding: 4rem;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: var(--shadow);
        }
        
        #order-success-message h1 {
            color: var(--success-color);
            font-size: 2.5rem;
        }
        
        #order-success-message p {
            font-size: 1.2rem;
            margin-bottom: 2rem;
        }
        
        #order-number-display {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--dark-color);
            margin-bottom: 2rem;
        }
        
        /* --- Toast Notification --- */
        #toast-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--dark-color);
            color: white;
            padding: 1rem 2rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s, bottom 0.3s;
        }
        
        #toast-notification.show {
            opacity: 1;
            visibility: visible;
            bottom: 30px;
        }
        
        /* --- Confirmation Modal --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-box {
            background-color: #ffffff;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 450px;
            text-align: center;
        }
        
        .modal-box h3 {
            font-size: 1.5rem;
            color: var(--dark-color);
            margin-bottom: 1rem;
        }
        
        .modal-box p {
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }
        
        .modal-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .modal-actions .btn {
            min-width: 100px;
        }


        /* --- Footer --- */
        .site-footer {
            background-color: var(--dark-color);
            color: var(--light-color);
            padding: 3rem 0;
            margin-top: 2rem;
        }
        
        .footer-container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 2rem;
        }
        
        .footer-column {
            text-align: left;
        }
        
        .footer-column h4 {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: white;
        }
        
        .footer-column ul {
            list-style: none;
        }
        
        .footer-column ul li {
            margin-bottom: 0.5rem;
        }
        
        .footer-column ul li a {
            text-decoration: none;
            color: var(--light-color);
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        
        .footer-column ul li a:hover {
            opacity: 1;
        }
        
        .footer-copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid #4a4a4a;
            color: var(--light-color);
            opacity: 0.7;
        }

        /* --- Responsive Design --- */
        @media (max-width: 992px) {
            .product-page-layout {
                flex-direction: column;
            }
            .filter-sidebar {
                flex: 0 0 auto; /* Allow sidebar to grow */
                width: 100%;
            }

            /* --- Fix for header on medium screens --- */
            .header-container {
                flex-wrap: wrap; /* Allow items to wrap */
                row-gap: 1rem; /* Add gap between rows */
            }
            
            .logo {
                flex-basis: 40%; /* Give logo space */
                flex-shrink: 0;
            }
            
            .search-form {
                order: 3; /* Move search to the bottom row */
                width: 100%; /* Make it full width */
                max-width: none; /* Remove max-width */
            }
            
            .main-nav {
                flex-basis: 60%; /* Give nav space */
                flex-grow: 1; /* Allow it to grow */
            }
            
            .main-nav ul {
                flex-wrap: wrap; /* Allow nav links to wrap */
                justify-content: flex-end;
            }
            /* --- End header fix --- */
        }
        
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            .main-nav ul {
                justify-content: center;
                flex-wrap: wrap;
                gap: 1rem;
            }
            #product-detail-content {
                flex-direction: column;
            }
            .product-detail-image {
                max-width: 100%;
                height: 300px;
            }
            #cart-table {
                font-size: 0.9rem;
            }
            #cart-table th, #cart-table td {
                padding: 0.75rem;
            }
            .cart-item-name, .cart-item-quantity input, .btn-danger {
                font-size: 0.9rem;
            }
            .cart-item-quantity input {
                width: 40px;
            }
            .slide-content {
                bottom: 20px;
                left: 20px;
                padding: 1rem;
            }
            .slide-content h3 {
                font-size: 1.5rem;
            }
            .slide img {
                height: 300px;
            }
            .footer-container {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .footer-column {
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                font-size: 1.5rem;
            }
            .main-nav a {
                font-size: 0.9rem;
                padding: 0.4rem;
            }
            .hero h1 {
                font-size: 2rem;
            }
            .hero p {
                font-size: 1rem;
            }
            /* Hide table headers and show as blocks */
            #cart-table thead {
                display: none;
            }
            #cart-table tr {
                display: block;
                margin-bottom: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                overflow: hidden;
            }
            #cart-table td {
                display: block;
                text-align: right;
                padding-left: 50%;
                position: relative;
                border: none;
                border-bottom: 1px solid var(--border-color);
            }
            #cart-table td:last-child {
                border-bottom: none;
            }
            #cart-table td::before {
                content: attr(data-label);
                position: absolute;
                left: 10px;
                text-align: left;
                font-weight: 600;
                text-transform: uppercase;
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>

    <!-- Header -->
    <header class="site-header">
        <div class="header-container">
            <a href="#home" class="logo">QA Test Store</a>
            
            <!-- Search Form -->
            <form class="search-form" id="search-form">
                <input type="search" id="search-input" placeholder="Search by name or SKU...">
                <button type="submit">üîç</button>
            </form>
            
            <nav class="main-nav">
                <ul>
                    <li><a href="#home" class="nav-link-header active" data-page="page-home">Home</a></li>
                    <li><a href="#categories" class="nav-link-header" data-page="page-categories">Categories</a></li>
                    <li><a href="#products" class="nav-link-header" data-page="page-products">All Products</a></li>
                    <li><a href="#wishlist" id="wishlist-link" class="nav-link-header nav-icon-link" data-page="page-wishlist" title="Wishlist">‚ù§</a></li>
                    <li><a href="#compare" id="compare-link" class="nav-link-header nav-icon-link" data-page="page-compare" title="Compare">‚áÜ</a></li>
                    
                    <li class="mini-cart" id="mini-cart-toggle">
                        <span class="mini-cart-icon">
                            üõí
                            <span id="cart-count">0</span>
                        </span>
                        <div class="mini-cart-dropdown">
                            <div id="mini-cart-items">
                                <!-- Mini cart items will be injected here -->
                                <p>Your cart is empty.</p>
                            </div>
                            <div class="mini-cart-summary">
                                <div class="subtotal">
                                    <span>Subtotal:</span>
                                    <span id="mini-cart-subtotal">$0.00</span>
                                </div>
                            </div>
                            <div class="mini-cart-actions">
                                <a href="#cart" class="btn btn-secondary">View Cart</a>
                                <a href="#checkout" class="btn btn-primary">Checkout</a>
                            </div>
                        </div>
                    </li>
                    
                    <li id="nav-login-item"><a href="#login" class="nav-link-header" data-page="page-login">Login</a></li>
                    <li id="nav-account-item" class="hidden"><a href="#account" class="nav-link-header" data-page="page-account">My Account</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container">

        <!-- Page 1: Home -->
        <section id="page-home" class="page">
            <div class="hero">
                <h1>Welcome to the QA Test Store!</h1>
                <p>The perfect place to test your manual and automation scripts.</p>
                <a href="#products" class="cta-button">Shop All Products</a>
            </div>
            
            <!-- Slider -->
            <div class="slider-container">
                <div class="slider">
                    <!-- Slides will be injected by JS -->
                </div>
                <div class="slider-nav">
                    <button id="prev-slide">&larr;</button>
                    <button id="next-slide">&rarr;</button>
                </div>
            </div>
            
            <!-- Featured Products -->
            <section id="featured-products-container">
                <h3 class="section-title">Featured Products</h3>
                <div id="featured-products">
                    <!-- Featured products grid -->
                </div>
            </section>
            
            <!-- Bestseller Products -->
            <section id="bestseller-products-container">
                <h3 class="section-title">Best Sellers</h3>
                <div id="bestseller-products">
                    <!-- Bestseller products grid -->
                </div>
            </section>
            
        </section>
        
        <!-- Page: Categories -->
        <section id="page-categories" class="page hidden">
            <h1>Product Categories</h1>
            <div id="category-grid">
                <!-- Categories will be dynamically inserted here -->
            </div>
        </section>

        <!-- Page 2: Products (All) -->
        <section id="page-products" class="page hidden">
            <h1>All Products</h1>
            <div class="product-page-layout">
                <aside class="filter-sidebar">
                    <h3>Filters</h3>
                    <div class="filter-group">
                        <h4>Category</h4>
                        <div id="category-filters">
                            <!-- Category checkboxes will be injected here -->
                        </div>
                    </div>
                    <div class="filter-group">
                        <h4>Price</h4>
                        <div class="price-filter-inputs">
                            <input type="number" id="price-min" placeholder="Min" min="0">
                            <span>-</span>
                            <input type="number" id="price-max" placeholder="Max" min="0">
                        </div>
                    </div>
                    <div class="filter-buttons">
                        <button class="btn btn-primary" id="apply-filters-btn">Apply</button>
                        <button class="btn btn-secondary" id="clear-filters-btn">Clear</button>
                    </div>
                </aside>
                <div class="product-grid-container">
                    <div id="product-grid">
                        <!-- Products will be dynamically inserted here by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Page: Category Products -->
        <section id="page-category-products" class="page hidden">
            <h1 id="category-products-title">Category: </h1>
            <a href="#categories" class="btn btn-secondary" style="margin-bottom: 2rem; display: inline-block;">&larr; Back to Categories</a>
            <div id="category-product-grid">
                <!-- Filtered products will be inserted here -->
            </div>
        </section>

        <!-- Page 3: Product Detail -->
        <section id="page-product-detail" class="page hidden">
            <a href="#products" class="btn btn-secondary" id="back-to-products-btn" style="margin-bottom: 2rem; display: inline-block;">&larr; Back to Products</a>
            <div id="product-detail-content">
                <div class="product-detail-image">
                    <img id="detail-image" src="https://placehold.co/400x400/eeeeee/333333?text=Product" alt="Product Image">
                </div>
                <div class="product-detail-info">
                    <h1 id="detail-name">Product Name</h1>
                    <div id="detail-price">$0.00</div>
                    <div id="detail-sku">SKU: </div>
                    <p id="detail-desc">Full product description...</p>
                    <div class="quantity-control">
                        <div class="quantity-control-inner">
                            <label for="detail-quantity">Quantity:</label>
                            <input type="number" id="detail-quantity" value="1" min="1" step="1">
                        </div>
                        <div class="field-error" id="detail-quantity-error">Please enter a whole number (1 or more).</div>
                    </div>
                    <button class="btn btn-primary cta-button" id="detail-add-to-cart-btn">Add to Cart</button>
                    <div class="detail-actions">
                        <button class="btn btn-secondary" id="detail-add-to-wishlist-btn">‚ù§ Add to Wishlist</button>
                        <button class="btn btn-secondary" id="detail-add-to-compare-btn">‚áÜ Add to Compare</button>
                    </div>
                </div>
            </div>
            
            <!-- Related Products -->
            <section id="related-products-container">
                <h3 class="section-title">You May Also Like</h3>
                <div id="related-products">
                    <!-- Related products grid -->
                </div>
            </section>
            
        </section>

        <!-- Page 4: Cart -->
        <section id="page-cart" class="page hidden">
            <h1>Your Shopping Cart</h1>
            <div id="cart-content">
                <!-- Cart items or empty message will be shown here -->
            </div>
        </section>

        <!-- Page 5: Checkout -->
        <section id="page-checkout" class="page hidden">
            <h1>Checkout</h1>
            <div class="form-container" id="checkout-form-container">
                <form id="checkout-form" novalidate>
                    <h4 class="form-section-title">Shipping Address</h4>
                    
                    <div class="form-group">
                        <label for="checkout-name">Full Name</label>
                        <input type="text" id="checkout-name" name="name" required>
                        <div class="form-error" id="name-error">Full name is required.</div>
                    </div>
                    <div class="form-group">
                        <label for="checkout-email">Email Address</label>
                        <input type="email" id="checkout-email" name="email" required>
                        <div class="form-error" id="email-error">A valid email is required.</div>
                    </div>
                    <div class="form-group">
                        <label for="checkout-address">Shipping Address</label>
                        <textarea id="checkout-address" name="address" required></textarea>
                        <div class="form-error" id="address-error">Address is required.</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="checkout-country">Country</label>
                        <select id="checkout-country" name="country" required>
                            <option value="US">US</option>
                            <option value="Russia">Russia</option>
                            <option value="Japan">Japan</option>
                            <option value="India">India</option>
                            <option value="South Korea">South Korea</option>
                            <option value="Brazil">Brazil</option>
                            <option value="Canada">Canada</option>
                            <option value="China">China</option>
                            <option value="Spain">Spain</option>
                            <option value="Sri Lanka">Sri Lanka</option>
                        </select>
                        <div class="form-error" id="country-error">Country is required.</div>
                    </div>
                    
                    <h4 class="form-section-title">Payment</h4>
                    
                    <div class="form-group">
                        <label for="checkout-card">Credit Card Number</label>
                        <input type="text" id="checkout-card" name="card" pattern="\d{16}" title="16-digit card number" required>
                        <div class="form-error" id="card-error">A 16-digit card number is required.</div>
                    </div>
                    
                    <div class="form-group filter-option">
                        <input type="checkbox" id="billing-same-as-shipping" checked>
                        <label for="billing-same-as-shipping">Billing address is the same as shipping</label>
                    </div>
                    
                    <div id="billing-address-group" class="hidden">
                        <h4 class="form-section-title">Billing Address</h4>
                         <div class="form-group">
                            <label for="billing-name">Full Name</label>
                            <input type="text" id="billing-name" name="billing-name">
                            <div class="form-error" id="billing-name-error">Full name is required.</div>
                        </div>
                        <div class="form-group">
                            <label for="billing-address">Billing Address</label>
                            <textarea id="billing-address" name="billing-address"></textarea>
                            <div class="form-error" id="billing-address-error">Address is required.</div>
                        </div>
                    </div>
                    
                    <button type="submit" class="cta-button checkout-button">Place Order</button>
                </form>
            </div>
        </section>
        
        <!-- Page 6: Order Success -->
        <section id="page-order-success" class="page hidden">
            <div id="order-success-message">
                <h1>Thank You!</h1>
                <p>Your order has been placed successfully.</p>
                <p id="order-number-display"></p>
                <a href="#home" class="cta-button">Back to Home</a>
            </div>
        </section>
        
        <!-- Page 7: Login -->
        <section id="page-login" class="page hidden">
            <div class="form-container">
                <h1>Login</h1>
                <form id="login-form" novalidate>
                    <div class="form-group">
                        <label for="login-email">Email Address</label>
                        <input type="email" id="login-email" name="email" required>
                        <div class="form-error" id="login-email-error">A valid email is required.</div>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" required>
                        <div class="form-error" id="login-password-error">Password is required.</div>
                    </div>
                    <button type="submit" class="cta-button" style="width: 100%;">Login</button>
                </form>
                <p style="margin-top: 1.5rem;">
                    Don't have an account? <a href="#signup" id="signup-link">Sign Up</a>
                </p>
            </div>
        </section>
        
        <!-- Page 8: My Account -->
        <section id="page-account" class="page hidden">
            <h1>My Account</h1>
            <div class="account-page-box">
                <h2>Welcome, Test User!</h2>
                <ul id="account-user-email">
                    <!-- User email will be injected here -->
                </ul>
                <ul>
                    <li><a href="#wishlist" id="account-wishlist-link">My Wishlist</a></li>
                    <li><a href="#compare" id="account-compare-link">My Compare List</a></li>
                    <li><a href="#" id="account-orders-link">My Orders (Coming Soon)</a></li>
                </ul>
                <button id="logout-btn" class="btn btn-danger">Logout</button>
            </div>
        </section>
        
        <!-- Page 9: Wishlist -->
        <section id="page-wishlist" class="page hidden">
            <h1>My Wishlist</h1>
            <div id="wishlist-grid">
                <!-- Wishlist items go here -->
            </div>
        </section>
        
        <!-- Page 10: Compare -->
        <section id="page-compare" class="page hidden">
            <h1>Compare Products</h1>
            <div id="compare-table-container">
                 <!-- Compare table will be injected here -->
            </div>
            <div id="compare-empty-message" class="hidden" style="text-align: center; font-size: 1.2rem; padding: 3rem; background-color: #ffffff; border-radius: 12px; box-shadow: var(--shadow);">
                <p>There are no items to compare.</p>
            </div>
        </section>
        
        <!-- Page 11: Sign Up -->
        <section id="page-signup" class="page hidden">
             <div class="form-container">
                <h1>Create Account</h1>
                <form id="signup-form" novalidate>
                    <div class="form-group">
                        <label for="signup-name">Full Name</label>
                        <input type="text" id="signup-name" name="name" required>
                        <div class="form-error" id="signup-name-error">Full name is required.</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" name="email" required>
                        <div class="form-error" id="signup-email-error">A valid email is required.</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" name="password" required>
                        <div class="form-error" id="signup-password-error">Password must be at least 6 characters.</div>
                    </div>
                    <div class="form-group">
                        <label for="signup-password-confirm">Confirm Password</label>
                        <input type="password" id="signup-password-confirm" name="password-confirm" required>
                        <div class="form-error" id="signup-password-confirm-error">Passwords do not match.</div>
                    </div>
                    <button type="submit" class="cta-button" style="width: 100%;">Create Account</button>
                </form>
                 <p style="margin-top: 1.5rem;">
                    Already have an account? <a href="#login" id="login-link">Login</a>
                </p>
            </div>
        </section>

    </main>
    
    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay" style="display: none;">
        <div class="modal-box">
            <h3 id="modal-title">Are you sure?</h3>
            <p id="modal-message">This action cannot be undone.</p>
            <div class="modal-actions">
                <button id="modal-cancel-btn" class="btn btn-secondary">Cancel</button>
                <button id="modal-confirm-btn" class="btn btn-danger">Remove</button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast-notification">Item added to cart!</div>

    <!-- Footer -->
    <footer class="site-footer">
        <div class="footer-container">
            <div class="footer-column">
                <h4>About</h4>
                <ul>
                    <li><a href="#">About Us</a></li>
                    <li><a href="#">Careers</a></li>
                    <li><a href="#">Press</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Support</h4>
                <ul>
                    <li><a href="#">Contact Us</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="#">Shipping Policy</a></li>
                    <li><a href="#">Returns</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>Legal</h4>
                <ul>
                    <li><a href="#">Privacy Policy</a></li>
                    <li><a href="#">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h4>QA Test Store</h4>
                <p>For educational and testing purposes only.</p>
            </div>
        </div>
        <div class="footer-copyright">
            <p>&copy; 2025 QA Test Store. All rights reserved.</p>
        </div>
    </footer>

    <!-- JavaScript for functionality -->
        <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // --- STATE ---
            const products = [
                {
                    id: 1,
                    name: 'Manual Testing Handbook',
                    price: 49.99,
                    sku: 'QA-BOOK-01',
                    description_short: 'The ultimate guide to manual software testing techniques.',
                    description_full: 'This comprehensive handbook covers everything from test case design and execution to bug reporting and regression testing. A must-have for any aspiring QA engineer.',
                    image: 'https://placehold.co/600x400/0a4a91/white?text=Manual+Testing+Handbook',
                    category: 'Books'
                },
                {
                    id: 2,
                    name: 'Automation Pro Suite',
                    price: 299.99,
                    sku: 'QA-SW-01',
                    description_short: 'A complete software suite for all your automation needs.',
                    description_full: 'Includes a powerful test runner, element inspector, and report generator. Supports Selenium, Cypress, and Playwright. License valid for one year.',
                    image: 'https://placehold.co/600x400/28a745/white?text=Automation+Suite',
                    category: 'Software'
                },
                {
                    id: 3,
                    name: 'QA-Bot 3000',
                    price: 149.50,
                    sku: 'QA-MERCH-01',
                    description_short: 'A friendly robot to find bugs for you. (Figurine)',
                    description_full: 'This 6-inch articulated figurine is the perfect desk companion for any tester. It doesn\'t actually find bugs, but it will listen to your complaints.',
                    image: 'https://placehold.co/600x400/dc3545/white?text=QA-Bot+3000',
                    category: 'Merchandise'
                },
                {
                    id: 4,
                    name: 'The "It Works on My Machine" Mug',
                    price: 15.99,
                    sku: 'QA-MERCH-02',
                    description_short: 'The classic developer excuse, now on a 12oz mug.',
                    description_full: 'Start your day with a laugh. This high-quality ceramic mug is dishwasher and microwave safe. A perfect gift for any developer or tester.',
                    image: 'https://placehold.co/600x400/343a40/white?text=QA+Mug',
                    category: 'Merchandise'
                },
                {
                    id: 5,
                    name: 'Agile Workflow Poster',
                    price: 25.00,
                    sku: 'QA-MERCH-03',
                    description_short: 'A high-quality print of a confusingly complex agile board.',
                    description_full: 'Impress your colleagues with this 24x36 inch poster depicting a comically intricate agile workflow. Guaranteed to spark conversations... or confusion.',
                    image: 'https://placehold.co/600x400/007bff/white?text=Agile+Poster',
                    category: 'Merchandise'
                },
                {
                    id: 6,
                    name: 'Intro to Selenium Course',
                    price: 199.00,
                    sku: 'QA-COURSE-01',
                    description_short: 'A 10-hour video course on Selenium WebDriver.',
                    description_full: 'Learn the fundamentals of browser automation with Selenium. This course covers element locators, waits, Page Object Model, and more.',
                    image: 'https://placehold.co/600x400/ffc107/black?text=Selenium+Course',
                    category: 'Courses'
                },
                {
                    id: 7,
                    name: 'API Testing with Postman',
                    price: 79.99,
                    sku: 'QA-COURSE-02',
                    description_short: 'Master API testing from basics to advanced scripting.',
                    description_full: 'This e-book and video bundle will teach you how to test REST and SOAP APIs, write test scripts, and automate your API tests in a CI/CD pipeline.',
                    image: 'https://placehold.co/600x400/6f42c1/white?text=API+Testing+Course',
                    category: 'Courses'
                },
                {
                    id: 8,
                    name: 'Bug Tracker Pro (1yr License)',
                    price: 99.00,
                    sku: 'QA-SW-02',
                    description_short: 'A simple, powerful bug tracking tool for small teams.',
                    description_full: 'Stop using spreadsheets. Bug Tracker Pro offers a clean interface, custom fields, and simple reporting. 1-year license for up to 5 users.',
                    image: 'https://placehold.co/600x400/17a2b8/white?text=Bug+Tracker+Pro',
                    category: 'Software'
                },
                {
                    id: 9,
                    name: 'QA Test Laptop',
                    price: 1299.99,
                    sku: 'QA-ELEC-01',
                    description_short: 'A high-spec laptop for running all your tests.',
                    description_full: '32GB RAM, 1TB SSD, 8-core CPU. Pre-installed with all major browsers and IDEs. Perfect for parallel test execution.',
                    image: 'https://placehold.co/600x400/fd7e14/white?text=Test+Laptop',
                    category: 'Electronics'
                },
                {
                    id: 10,
                    name: 'Ergonomic Wireless Mouse',
                    price: 45.50,
                    sku: 'QA-ELEC-02',
                    description_short: 'A comfortable mouse for those long testing sessions.',
                    description_full: 'Vertical ergonomic design to reduce wrist strain. 2.4GHz wireless with USB-C charging. 7 programmable buttons.',
                    image: 'https://placehold.co/600x400/6610f2/white?text=Ergo+Mouse',
                    category: 'Electronics'
                },
                {
                    id: 11,
                    name: '"I Test Therefore I Am" T-Shirt',
                    price: 22.99,
                    sku: 'QA-APP-01',
                    description_short: 'Show your QA pride with this comfy cotton t-shirt.',
                    description_full: '100% ring-spun cotton. Available in S, M, L, XL, XXL. A perfect gift for the philosopher-tester in your life.',
                    image: 'https://placehold.co/600x400/e83e8c/white?text=QA+T-Shirt',
                    category: 'Apparel'
                },
                {
                    id: 12,
                    name: 'QA Sticker Pack',
                    price: 9.99,
                    sku: 'QA-MERCH-04',
                    description_short: 'Vinyl stickers for your laptop (Bug, Selenium, etc.).',
                    description_full: 'Pack of 10 high-quality, waterproof vinyl stickers. Includes a bug icon, Selenium logo, Postman logo, and other fun QA-themed designs.',
                    image: 'https://placehold.co/600x400/20c997/white?text=Sticker+Pack',
                    category: 'Merchandise'
                }
            ];
            
            const categories = [...new Set(products.map(p => p.category))].map(cat => {
                const product = products.find(p => p.category === cat);
                return {
                    name: cat,
                    image: product.image.replace('600x400', '400x300') // Use first product's image for category
                }
            });
            
            const sliderSlides = [
                {
                    title: 'New: QA Test Laptop',
                    image: 'https://placehold.co/1200x400/fd7e14/white?text=High-Spec+Test+Laptop',
                    link: '#products/9'
                },
                {
                    title: 'Get Your "It Works on My Machine" Mug',
                    image: 'https://placehold.co/1200x400/343a40/white?text=Classic+QA+Merch',
                    link: '#products/4'
                },
                {
                    title: 'Automation Pro Suite',
                    image: 'https://placehold.co/1200x400/28a745/white?text=Automation+Suite',
                    link: '#products/2'
                }
            ];
            
            // App state
            let users = [];
            let cart = [];
            let wishlist = [];
            let compareList = [];
            let isLoggedIn = false;
            let currentUser = null;
            let currentSlide = 0;
            let slideInterval;
            let currentModalConfirmCallback = () => {};
            let appliedCoupon = null;
            let discountAmount = 0;
            let currentSearchTerm = '';
            
            // Constants
            const shippingCost = 5.00;
            let taxRate = 0.05; // 5% (default)
            const couponCode = "100QATest";
            const couponDiscount = 0.5; // 50%

            // --- SELECTORS ---
            const pages = document.querySelectorAll('.page');
            const navHeaderLinks = document.querySelectorAll('.nav-link-header');
            const navLoginItem = document.getElementById('nav-login-item');
            const navAccountItem = document.getElementById('nav-account-item');
            const accountUserEmail = document.getElementById('account-user-email');
            
            const productGrid = document.getElementById('product-grid');
            const categoryGrid = document.getElementById('category-grid');
            const categoryProductGrid = document.getElementById('category-product-grid');
            const categoryProductsTitle = document.getElementById('category-products-title');
            const wishlistGrid = document.getElementById('wishlist-grid');
            const compareTableContainer = document.getElementById('compare-table-container');
            const compareEmptyMessage = document.getElementById('compare-empty-message');
            const featuredProductsGrid = document.getElementById('featured-products');
            const bestsellerProductsGrid = document.getElementById('bestseller-products');
            const relatedProductsGrid = document.getElementById('related-products');
            
            // Mini Cart Selectors
            const miniCartToggle = document.getElementById('mini-cart-toggle');
            const miniCartDropdown = document.querySelector('.mini-cart-dropdown');
            const cartCountEl = document.getElementById('cart-count');
            const miniCartItemsEl = document.getElementById('mini-cart-items');
            const miniCartSubtotalEl = document.getElementById('mini-cart-subtotal');
            const cartContentEl = document.getElementById('cart-content');
            
            // Form Selectors
            const checkoutForm = document.getElementById('checkout-form');
            const loginForm = document.getElementById('login-form');
            const signupForm = document.getElementById('signup-form');
            const logoutBtn = document.getElementById('logout-btn');
            const billingSameAsShippingCheck = document.getElementById('billing-same-as-shipping');
            const billingAddressGroup = document.getElementById('billing-address-group');
            const checkoutCountrySelect = document.getElementById('checkout-country');
            const checkoutCardInput = document.getElementById('checkout-card');
            
            // Search Selectors
            const searchForm = document.getElementById('search-form');
            const searchInput = document.getElementById('search-input');
            
            // Modal Selectors
            const modal = document.getElementById('confirmation-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalMessage = document.getElementById('modal-message');
            const modalCancelBtn = document.getElementById('modal-cancel-btn');
            const modalConfirmBtn = document.getElementById('modal-confirm-btn');
            
            const toastEl = document.getElementById('toast-notification');
            
            // Filter Selectors
            const categoryFiltersContainer = document.getElementById('category-filters');
            const priceMinInput = document.getElementById('price-min');
            const priceMaxInput = document.getElementById('price-max');
            const applyFiltersBtn = document.getElementById('apply-filters-btn');
            const clearFiltersBtn = document.getElementById('clear-filters-btn');
            
            // Product Detail Page Selectors
            const detailImageEl = document.getElementById('detail-image');
            const detailNameEl = document.getElementById('detail-name');
            const detailPriceEl = document.getElementById('detail-price');
            const detailSkuEl = document.getElementById('detail-sku');
            const detailDescEl = document.getElementById('detail-desc');
            const detailQuantityEl = document.getElementById('detail-quantity');
            const detailQuantityErrorEl = document.getElementById('detail-quantity-error');
            const detailAddToCartBtn = document.getElementById('detail-add-to-cart-btn');
            const detailAddToWishlistBtn = document.getElementById('detail-add-to-wishlist-btn');
            const detailAddToCompareBtn = document.getElementById('detail-add-to-compare-btn');
            const backToProductsBtn = document.getElementById('back-to-products-btn');

            // --- FUNCTIONS ---
            
            /**
             * Initializes the application.
             */
            function init() {
                // Fix for the modal bug - REMOVED, as it's now inline styled
                // document.getElementById('confirmation-modal').classList.add('hidden'); 
                
                loadState();
                renderCategories();
                initSlider();
                setupEventListeners();
                
                // Handle initial page load based on hash
                handleHashChange();
                // Listen for hash changes
                window.addEventListener('hashchange', handleHashChange);
            }
            
            /**
             * Handles routing based on the URL hash.
             */
            function handleHashChange() {
                const hash = window.location.hash.substring(1);
                
                // Close mini cart on nav
                miniCartToggle.classList.remove('open');
                
                let pageId = 'page-home';
                
                if (hash.startsWith('products/')) {
                    pageId = 'page-product-detail';
                    const productId = hash.split('/')[1];
                    showProductDetail(productId);
                } else if (hash.startsWith('category/')) {
                    pageId = 'page-category-products';
                    const categoryName = decodeURIComponent(hash.split('/')[1]);
                    showCategoryProducts(categoryName);
                } else if (hash.startsWith('cart')) {
                    pageId = 'page-cart';
                } else if (hash.startsWith('checkout')) {
                    pageId = 'page-checkout';
                } else if (hash.startsWith('categories')) {
                    pageId = 'page-categories';
                } else if (hash.startsWith('products')) {
                    pageId = 'page-products';
                } else if (hash.startsWith('success')) {
                    pageId = 'page-order-success';
                } else if (hash.startsWith('login')) {
                    pageId = 'page-login';
                } else if (hash.startsWith('signup')) {
                    pageId = 'page-signup';
                } else if (hash.startsWith('account')) {
                    pageId = 'page-account';
                } else if (hash.startsWith('wishlist')) {
                    pageId = 'page-wishlist';
                } else if (hash.startsWith('compare')) {
                    pageId = 'page-compare';
                }
                
                navigate(pageId);
            }
            
            /**
             * Sets up global event listeners (using delegation).
             */
            function setupEventListeners() {
                // Product card click delegation (for all product grids)
                document.getElementById('product-grid').addEventListener('click', handleProductGridClick);
                document.getElementById('category-product-grid').addEventListener('click', handleProductGridClick);
                document.getElementById('wishlist-grid').addEventListener('click', handleProductGridClick);
                document.getElementById('featured-products').addEventListener('click', handleProductGridClick);
                document.getElementById('bestseller-products').addEventListener('click', handleProductGridClick);
                document.getElementById('related-products').addEventListener('click', handleProductGridClick);
                
                // Compare Table Clicks
                compareTableContainer.addEventListener('click', (e) => {
                    if (e.target.classList.contains('add-to-cart-btn')) {
                        e.preventDefault();
                        const productId = e.target.dataset.id;
                        addToCart(productId);
                        showToast('Item added to cart!');
                    }
                    if (e.target.classList.contains('remove-from-compare-btn')) {
                        e.preventDefault();
                        const productId = e.target.dataset.id;
                        showConfirmationModal('Are you sure you want to remove this from compare?', () => {
                            addToCompare(productId); // Toggles off
                            renderComparePage(); // Re-render table
                        });
                    }
                });

                // Product Detail Page Buttons
                detailAddToCartBtn.addEventListener('click', () => {
                    if (validateQuantity(detailQuantityEl, detailQuantityErrorEl)) {
                        const productId = detailAddToCartBtn.dataset.id;
                        const quantity = parseInt(detailQuantityEl.value, 10);
                        addToCart(productId, quantity);
                        showToast('Item added to cart!');
                    }
                });
                
                detailAddToWishlistBtn.addEventListener('click', (e) => {
                    handleAuthAction(() => {
                        const productId = e.target.dataset.id;
                        const isInWishlist = wishlist.includes(productId.toString());
                        if (isInWishlist) {
                            showConfirmationModal('Remove from wishlist?', () => {
                                addToWishlist(productId);
                                updateWishlistHeart(e.target, productId);
                            });
                        } else {
                            addToWishlist(productId);
                            updateWishlistHeart(e.target, productId);
                        }
                    });
                });
                
                detailAddToCompareBtn.addEventListener('click', (e) => {
                    const productId = e.target.dataset.id;
                    handleAuthAction(() => addToCompare(productId));
                });
                
                // Detail page quantity validation on input
                detailQuantityEl.addEventListener('input', () => {
                    validateQuantity(detailQuantityEl, detailQuantityErrorEl);
                });

                // Cart click delegation
                cartContentEl.addEventListener('click', (e) => {
                    // Remove from cart
                    if (e.target.classList.contains('remove-from-cart-btn')) {
                        const productId = e.target.dataset.id;
                        showConfirmationModal('Are you sure you want to remove this item?', () => {
                            removeFromCart(productId);
                        });
                    }
                    // Apply coupon
                    if (e.target.id === 'apply-coupon-btn') {
                        applyCoupon();
                    }
                });
                
                // Cart quantity change (on 'change' not 'input' to avoid firing on every keystroke)
                cartContentEl.addEventListener('change', (e) => {
                    if (e.target.classList.contains('cart-quantity-input')) {
                        const inputEl = e.target;
                        const errorEl = inputEl.nextElementSibling;
                        const productId = inputEl.dataset.id;
                        const product = getProductById(productId);
                        
                        if (validateQuantity(inputEl, errorEl, true)) {
                            const newQuantity = parseInt(inputEl.value, 10);
                            if (newQuantity < 1) {
                                showConfirmationModal(`This will remove "${product.name}" from your cart. OK?`, () => {
                                    removeFromCart(productId);
                                }, 'Remove Item?');
                                // Revert value if they cancel
                                const oldItem = cart.find(item => item.id == productId);
                                inputEl.value = oldItem ? oldItem.quantity : 1;
                            } else {
                                updateCartQuantity(productId, newQuantity);
                            }
                        }
                    }
                });
                
                // Forms
                checkoutForm.addEventListener('submit', handleCheckout);
                loginForm.addEventListener('submit', handleLogin);
                signupForm.addEventListener('submit', handleSignup);
                logoutBtn.addEventListener('click', handleLogout);
                billingSameAsShippingCheck.addEventListener('change', (e) => {
                    billingAddressGroup.classList.toggle('hidden', e.target.checked);
                });
                checkoutCountrySelect.addEventListener('change', handleCountryChange);
                
                // Search Form
                // Listener for "Enter" key or submit button click
                searchForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    currentSearchTerm = searchInput.value.trim().toLowerCase();
                    
                    // If we are already on the products page, just apply filters
                    // Otherwise, navigate to it, which will trigger applyFilters
                    if (window.location.hash.startsWith('#products')) {
                        applyFilters();
                    } else {
                        window.location.hash = 'products';
                    }
                });

                // Listener for live typing (instant search)
                searchInput.addEventListener('input', () => {
                    currentSearchTerm = searchInput.value.trim().toLowerCase();

                    // If the user is typing, we assume they want to see the product page.
                    if (window.location.hash.startsWith('#products')) {
                        // If we are already on the products page, just apply filters
                        applyFilters();
                    } else {
                        // If on another page, navigate to products page to show results
                        // The `handleHashChange` will trigger `applyFilters`
                        window.location.hash = 'products';
                    }
                });
                
                // Filter buttons
                applyFiltersBtn.addEventListener('click', applyFilters);
                clearFiltersBtn.addEventListener('click', clearFilters);
                
                // Slider navigation
                document.getElementById('prev-slide').addEventListener('click', () => {
                    changeSlide(-1);
                    resetSlideInterval();
                });
                document.getElementById('next-slide').addEventListener('click', () => {
                    changeSlide(1);
                    resetSlideInterval();
                });
                
                // Modal Buttons
                modalCancelBtn.addEventListener('click', hideConfirmationModal);
                modalConfirmBtn.addEventListener('click', () => {
                    currentModalConfirmCallback();
                    hideConfirmationModal();
                });
                
                // Mini Cart Toggle
                miniCartToggle.addEventListener('click', (e) => {
                    // Prevent closing if click is inside dropdown
                    if (!e.target.closest('.mini-cart-dropdown')) {
                        miniCartToggle.classList.toggle('open');
                    }
                });
                
                // Close mini cart if clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.mini-cart')) {
                        miniCartToggle.classList.remove('open');
                    }
                });
            }
            
            /**
             * Handles clicks inside product grids.
             */
            function handleProductGridClick(e) {
                const target = e.target;
                
                // Add to Cart
                if (target.classList.contains('add-to-cart-btn')) {
                    e.preventDefault();
                    const productId = target.dataset.id;
                    addToCart(productId);
                    showToast('Item added to cart!');
                }
                
                // Add to Wishlist
                if (target.classList.contains('add-to-wishlist-btn')) {
                    e.preventDefault();
                    
                    handleAuthAction(() => {
                        const productId = target.dataset.id;
                        const isInWishlist = wishlist.includes(productId.toString());
                        
                        if (isInWishlist) {
                            showConfirmationModal('Remove from wishlist?', () => {
                                addToWishlist(productId); // This will toggle (remove)
                                updateWishlistHeart(target, productId);
                            });
                        } else {
                            addToWishlist(productId); // This will toggle (add)
                            updateWishlistHeart(target, productId);
                        }
                    });
                }
                
                // Add to Compare
                if (target.classList.contains('add-to-compare-btn')) {
                    e.preventDefault();
                    const productId = target.dataset.id;
                    handleAuthAction(() => addToCompare(productId));
                }
            }

            /**
             * Hides all pages and shows the one with the specified ID.
             * @param {string} pageId - The ID of the page to show.
             */
            function navigate(pageId) {
                // Hide all pages
                pages.forEach(page => page.classList.add('hidden'));
                
                // Show the target page
                const targetPage = document.getElementById(pageId);
                if (targetPage) {
                    targetPage.classList.remove('hidden');
                } else {
                    // Fallback to home page if ID is invalid
                    document.getElementById('page-home').classList.remove('hidden');
                    pageId = 'page-home';
                }

                // Update active nav link
                navHeaderLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.dataset.page === pageId) {
                        link.classList.add('active');
                    }
                });
                
                // Specific page rendering logic
                switch(pageId) {
                    case 'page-home':
                        renderHomeSections();
                        resetSlideInterval();
                        break;
                    case 'page-products':
                        populateCategoryFilters();
                        applyFilters(); // Apply current (or no) filters
                        break;
                    case 'page-cart':
                        renderCart();
                        break;
                    case 'page-wishlist':
                        document.getElementById('wishlist-link').classList.add('active');
                        renderWishlistPage();
                        break;
                    case 'page-compare':
                        document.getElementById('compare-link').classList.add('active');
                        renderComparePage();
                        break;
                    case 'page-account':
                        document.getElementById('nav-account-item').querySelector('a').classList.add('active');
                        accountUserEmail.innerHTML = `<li>Logged in as: <strong>${currentUser.email}</strong></li>`;
                        break;
                }
                
                // Stop slider if not on home page
                if (pageId !== 'page-home') {
                    clearInterval(slideInterval);
                }
                
                // Update nav based on login state
                updateNav();
                
                // Scroll to top
                window.scrollTo(0, 0);
            }
            
            /**
             * Updates nav links based on login state
             */
            function updateNav() {
                if (isLoggedIn) {
                    navLoginItem.classList.add('hidden');
                    navAccountItem.classList.remove('hidden');
                } else {
                    navLoginItem.classList.remove('hidden');
                    navAccountItem.classList.add('hidden');
                }
            }
            
            // --- Slider Functions ---
            function initSlider() {
                const slider = document.querySelector('.slider');
                slider.innerHTML = sliderSlides.map(slide => `
                    <div class="slide">
                        <img src="${slide.image}" alt="${slide.title}">
                        <div class="slide-content">
                            <h3>${slide.title}</h3>
                            <a href="${slide.link}" class="btn btn-primary">Learn More</a>
                        </div>
                    </div>
                `).join('');
                showSlide(currentSlide);
                resetSlideInterval();
            }
            
            function changeSlide(direction) {
                const totalSlides = sliderSlides.length;
                currentSlide = (currentSlide + direction + totalSlides) % totalSlides;
                showSlide(currentSlide);
            }
            
            function showSlide(index) {
                const slider = document.querySelector('.slider');
                slider.style.transform = `translateX(-${index * 100}%)`;
            }
            
            function resetSlideInterval() {
                clearInterval(slideInterval);
                slideInterval = setInterval(() => changeSlide(1), 5000);
            }
            
            // --- Home Page Sections ---
            function renderHomeSections() {
                // "Featured" are first 4 products
                const featured = products.slice(0, 4);
                // "Bestsellers" are next 4
                const bestsellers = products.slice(4, 8);
                
                renderProducts(featuredProductsGrid, featured);
                renderProducts(bestsellerProductsGrid, bestsellers);
            }

            /**
             * Renders product cards into a specified grid.
             * @param {HTMLElement} gridEl - The grid element to render into.
             * @param {Array} productList - The list of products to render.
             */
            function renderProducts(gridEl, productList) {
                if (!gridEl) return;
                
                if (productList.length === 0) {
                    gridEl.innerHTML = '<p>No products found.</p>';
                    return;
                }
                
                gridEl.innerHTML = ''; // Clear existing
                
                productList.forEach(product => {
                    const isInWishlist = wishlist.includes(product.id.toString());
                    gridEl.innerHTML += `
                        <div class="product-card" id="product-${product.id}">
                            <div class="product-card-icons">
                                <span class="product-card-icon add-to-wishlist-btn ${isInWishlist ? 'active' : ''}" data-id="${product.id}" title="Add to Wishlist">‚ù§</span>
                                <span class="product-card-icon add-to-compare-btn" data-id="${product.id}" title="Add to Compare">‚áÜ</span>
                            </div>
                            <div class="product-image">
                                <img src="${product.image}" alt="${product.name}">
                            </div>
                            <div class="product-info">
                                <h3>${product.name}</h3>
                                <div class="product-price">$${product.price.toFixed(2)}</div>
                                <p class="product-desc-short">${product.description_short}</p>
                                <div class="product-actions">
                                    <a href="#products/${product.id}" class="btn btn-secondary">View Details</a>
                                    <a href="#" class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</a>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            /**
             * Renders the category grid.
             */
            function renderCategories() {
                categoryGrid.innerHTML = '';
                categories.forEach(cat => {
                    categoryGrid.innerHTML += `
                        <a href="#category/${encodeURIComponent(cat.name)}" class="category-card" data-category="${cat.name}">
                            <div class="category-image">
                                <img src="${cat.image}" alt="${cat.name}">
                            </div>
                            <div class="category-info">
                                <h3>${cat.name}</h3>
                            </div>
                        </a>
                    `;
                });
            }
            
            /**
             * Shows products for a specific category.
             * @param {string} categoryName - The name of the category.
             */
            function showCategoryProducts(categoryName) {
                categoryProductsTitle.textContent = `Category: ${categoryName}`;
                const filteredProducts = products.filter(p => p.category === categoryName);
                renderProducts(categoryProductGrid, filteredProducts);
                // Update back button context
                backToProductsBtn.href = `#categories`;
            }

            /**
             * Finds a product by ID.
             * @param {string|number} id - The ID of the product.
             * @returns {object|undefined} The product object or undefined.
             */
            function getProductById(id) {
                return products.find(p => p.id == id);
            }
            
            /**
             * Displays the product detail page for a given product ID.
             * @param {string|number} productId - The ID of the product.
             */
            function showProductDetail(productId) {
                const product = getProductById(productId);
                if (!product) {
                    window.location.hash = 'products'; // Product not found, go back
                    return;
                }
                
                detailImageEl.src = product.image.replace('600x400', '400x400');
                detailImageEl.alt = product.name;
                detailNameEl.textContent = product.name;
                detailPriceEl.textContent = `$${product.price.toFixed(2)}`;
                detailSkuEl.textContent = `SKU: ${product.sku}`;
                detailDescEl.textContent = product.description_full;
                detailQuantityEl.value = '1';
                detailQuantityErrorEl.style.display = 'none';
                detailAddToCartBtn.dataset.id = product.id;
                detailAddToWishlistBtn.dataset.id = product.id;
                detailAddToCompareBtn.dataset.id = product.id;
                
                // Update wishlist button state
                updateWishlistHeart(detailAddToWishlistBtn, productId);
                
                // Update back button context
                backToProductsBtn.href = `#products`;
                
                // Render related products
                const related = products.filter(p => p.category === product.category && p.id != productId).slice(0, 4);
                renderProducts(relatedProductsGrid, related);
            }
            
            /**
             * Validates a quantity input field.
             * @param {HTMLInputElement} inputEl - The quantity input element.
             * @param {HTMLElement} errorEl - The error message element.
             * @param {boolean} [allowZero=false] - Whether to allow 0 (for cart removal).
             * @returns {boolean} - True if valid, false otherwise.
             */
            function validateQuantity(inputEl, errorEl, allowZero = false) {
                const value = inputEl.value;
                const quantity = parseInt(value, 10);
                
                // Check if it's an integer, not empty, not NaN, and not a decimal
                if (value === '' || isNaN(quantity) || quantity.toString() !== value || quantity < (allowZero ? 0 : 1)) {
                    errorEl.textContent = "Please enter a whole number (1 or more).";
                    if(allowZero && quantity === 0) { // Allow 0 in cart to trigger removal
                         errorEl.style.display = 'none';
                         inputEl.classList.remove('invalid');
                         return true;
                    }
                    errorEl.style.display = 'block';
                    inputEl.classList.add('invalid');
                    return false;
                }
                
                errorEl.style.display = 'none';
                inputEl.classList.remove('invalid');
                return true;
            }
            
            // --- Filter Functions ---
            
            /**
             * Populates the category filter checkbox list.
             */
            function populateCategoryFilters() {
                categoryFiltersContainer.innerHTML = '';
                categories.forEach(cat => {
                    categoryFiltersContainer.innerHTML += `
                        <label class="filter-option">
                            <input type="checkbox" class="category-filter-check" value="${cat.name}">
                            ${cat.name}
                        </label>
                    `;
                });
            }
            
            /**
             * Applies the selected filters to the product grid.
             */
            function applyFilters() {
                // Get selected categories
                const selectedCategories = [];
                document.querySelectorAll('.category-filter-check:checked').forEach(checkbox => {
                    selectedCategories.push(checkbox.value);
                });
                
                // Get price range
                const minPrice = parseFloat(priceMinInput.value) || 0;
                const maxPrice = parseFloat(priceMaxInput.value) || Infinity;
                
                let filteredProducts = products;
                
                // Step 1: Filter by Search Term (if any)
                if (currentSearchTerm) {
                    filteredProducts = filteredProducts.filter(product => {
                        const nameMatch = product.name.toLowerCase().includes(currentSearchTerm);
                        const skuMatch = product.sku.toLowerCase().includes(currentSearchTerm);
                        return nameMatch || skuMatch;
                    });
                }
                
                // Step 2: Filter by Category
                if (selectedCategories.length > 0) {
                    filteredProducts = filteredProducts.filter(product => 
                        selectedCategories.includes(product.category)
                    );
                }
                
                // Step 3: Filter by Price
                filteredProducts = filteredProducts.filter(product => {
                    return product.price >= minPrice && product.price <= maxPrice;
                });
                
                renderProducts(productGrid, filteredProducts);
            }
            
            /**
             * Clears all active filters and re-renders all products.
             */
            function clearFilters() {
                document.querySelectorAll('.category-filter-check').forEach(checkbox => {
                    checkbox.checked = false;
                });
                priceMinInput.value = '';
                priceMaxInput.value = '';
                
                // Also clear search
                currentSearchTerm = '';
                searchInput.value = '';
                
                renderProducts(productGrid, products);
            }

            /**
             * Renders the items in the cart.
             */
            function renderCart() {
                if (cart.length === 0) {
                    cartContentEl.innerHTML = `
                        <div id="cart-empty-message">
                            <p>Your cart is empty.</p>
                            <a href="#products" class="cta-button">Continue Shopping</a>
                        </div>
                    `;
                    return;
                }

                let cartHtml = `
                    <table id="cart-table">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                                <th>Remove</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                const subtotal = calculateSubtotal();
                
                cart.forEach(item => {
                    const product = getProductById(item.id);
                    if (product) {
                        const itemTotal = item.quantity * product.price;
                        cartHtml += `
                            <tr class="cart-item" id="cart-item-${product.id}">
                                <td data-label="Product" class="cart-item-name">${product.name}</td>
                                <td data-label="Price">$${product.price.toFixed(2)}</td>
                                <td data-label="Quantity" class="cart-item-quantity">
                                    <input type="number" class="cart-quantity-input" value="${item.quantity}" min="0" step="1" data-id="${product.id}">
                                    <div class="field-error">Please enter a whole number.</div>
                                </td>
                                <td data-label="Total">$${itemTotal.toFixed(2)}</td>
                                <td data-label="Remove">
                                    <button class="btn btn-danger remove-from-cart-btn" data-id="${product.id}">Remove</button>
                                </td>
                            </tr>
                        `;
                    }
                });
                
                const tax = (subtotal - discountAmount) * taxRate;
                const grandTotal = subtotal - discountAmount + shippingCost + tax;

                cartHtml += `
                        </tbody>
                    </table>
                    <div class="cart-summary">
                        <div class="cart-summary-box">
                            <h2>Cart Summary</h2>
                            
                            <div class="coupon-form">
                                <input type="text" id="coupon-code-input" placeholder="Enter code '100QATest'">
                                <button class="btn btn-secondary" id="apply-coupon-btn">Apply</button>
                            </div>
                            
                            <div class="summary-line">
                                <span>Subtotal</span>
                                <span id="cart-subtotal">$${subtotal.toFixed(2)}</span>
                            </div>
                            
                            <div class="summary-line discount" id="cart-discount-line" ${discountAmount === 0 ? 'class="hidden"' : ''}>
                                <span>Discount</span>
                                <span id="cart-discount">-$${discountAmount.toFixed(2)}</span>
                            </div>
                            
                            <div class="summary-line">
                                <span>Shipping</span>
                                <span id="cart-shipping">$${shippingCost.toFixed(2)}</span>
                            </div>
                            <div class="summary-line">
                                <span>Tax (${(taxRate * 100).toFixed(0)}%)</span>
                                <span id="cart-tax">$${tax.toFixed(2)}</span>
                            </div>
                            <div class="summary-line grand-total">
                                <span>Grand Total</span>
                                <span id="cart-total">$${grandTotal.toFixed(2)}</span>
                            </div>
                            <a href="#checkout" id="checkout-btn" class="cta-button checkout-button">Proceed to Checkout</a>
                        </div>
                    </div>
                `;

                cartContentEl.innerHTML = cartHtml;
                
                // Restore coupon input if it was applied
                if (appliedCoupon) {
                    document.getElementById('coupon-code-input').value = appliedCoupon;
                }
            }
            
            /**
             * Renders the wishlist page.
             */
            function renderWishlistPage() {
                const wishlistProducts = products.filter(p => wishlist.includes(p.id.toString()));
                renderProducts(wishlistGrid, wishlistProducts);
            }
            
            /**
             * Renders the compare page as a table.
             */
            function renderComparePage() {
                 const compareProducts = products.filter(p => compareList.includes(p.id.toString()));
                 
                 if (compareProducts.length === 0) {
                     compareTableContainer.innerHTML = '';
                     compareEmptyMessage.classList.remove('hidden');
                     return;
                 }
                 
                 compareEmptyMessage.classList.add('hidden');
                 
                 let tableHTML = '<table class="compare-table">';
                 
                 // Head Row: Product Names
                 tableHTML += '<thead><tr><th>Feature</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<th>${product.name}</th>`;
                 });
                 tableHTML += '</tr></thead>';
                 
                 // Body Rows
                 tableHTML += '<tbody>';
                 
                 // Image Row
                 tableHTML += '<tr><th>Image</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td><img src="${product.image.replace('600x400', '150x150')}" alt="${product.name}" class="compare-image"></td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // Price Row
                 tableHTML += '<tr><th>Price</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td><div class="compare-price">$${product.price.toFixed(2)}</div></td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // SKU Row
                 tableHTML += '<tr><th>SKU</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td>${product.sku}</td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // Description Row
                 tableHTML += '<tr><th>Description</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td><p class="compare-desc">${product.description_full}</p></td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // Category Row
                 tableHTML += '<tr><th>Category</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td>${product.category}</td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // Add to Cart Row
                 tableHTML += '<tr><th>Add to Cart</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td><button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</button></td>`;
                 });
                 tableHTML += '</tr>';
                 
                 // Remove Row
                 tableHTML += '<tr><th>Remove</th>';
                 compareProducts.forEach(product => {
                     tableHTML += `<td><button class="btn btn-danger remove-from-compare-btn" data-id="${product.id}">Remove</button></td>`;
                 });
                 tableHTML += '</tr>';
                 
                 tableHTML += '</tbody></table>';
                 
                 compareTableContainer.innerHTML = tableHTML;
            }
            
            /**
             * Wraps an action that requires login.
             * @param {Function} action - The action to perform if logged in.
             */
            function handleAuthAction(action) {
                if (!isLoggedIn) {
                    window.location.hash = 'login';
                    showToast('Please log in to use this feature.');
                } else {
                    action();
                }
            }
            
            /**
             * Calculates the cart subtotal.
             * @returns {number} The cart subtotal.
             */
            function calculateSubtotal() {
                return cart.reduce((sum, item) => {
                    const product = getProductById(item.id);
                    return sum + (product ? item.quantity * product.price : 0);
                }, 0);
            }
            
            /**
             * Applies the discount coupon.
             */
            function applyCoupon() {
                const couponInput = document.getElementById('coupon-code-input');
                if (couponInput.value === couponCode) {
                    appliedCoupon = couponCode;
                    discountAmount = calculateSubtotal() * couponDiscount;
                    showToast('50% discount applied!');
                } else {
                    appliedCoupon = null;
                    discountAmount = 0;
                    showToast('Invalid coupon code.');
                }
                saveState();
                renderCart(); // Re-render cart to show discount
            }

            /**
             * Adds a product to the cart.
             * @param {string|number} productId - The ID of the product to add.
             * @param {number} [quantity=1] - The quantity to add.
             */
            function addToCart(productId, quantity = 1) {
                const existingItem = cart.find(item => item.id == productId);
                
                if (existingItem) {
                    existingItem.quantity += quantity;
                } else {
                    cart.push({ id: productId, quantity: quantity });
                }
                
                // Recalculate discount if a coupon is active
                if (appliedCoupon === couponCode) {
                    discountAmount = calculateSubtotal() * couponDiscount;
                }
                
                saveState();
                updateCartSummary(true);
            }

            /**
             * Removes a product from the cart.
             * @param {string|number} productId - The ID of the product to remove.
             */
            function removeFromCart(productId) {
                cart = cart.filter(item => item.id != productId);
                
                // Recalculate discount
                if (appliedCoupon === couponCode) {
                    discountAmount = calculateSubtotal() * couponDiscount;
                }
                
                saveState();
                updateCartSummary();
                renderCart(); // Re-render the cart page
            }
            
            /**
             * Updates the quantity of a product in the cart.
             * @param {string|number} productId - The ID of the product to update.
             * @param {number} newQuantity - The new quantity.
             */
            function updateCartQuantity(productId, newQuantity) {
                if (newQuantity < 1) {
                    removeFromCart(productId);
                    return;
                }
                
                const item = cart.find(item => item.id == productId);
                if (item) {
                    item.quantity = newQuantity;
                }
                
                // Recalculate discount
                if (appliedCoupon === couponCode) {
                    discountAmount = calculateSubtotal() * couponDiscount;
                }
                
                saveState();
                updateCartSummary();
                renderCart(); // Re-render cart to update totals
            }
            
            /**
             * Adds/Removes a product to/from the wishlist.
             * @param {string|number} productId - The ID of the product.
             */
            function addToWishlist(productId) {
                productId = productId.toString();
                if (!wishlist.includes(productId)) {
                    wishlist.push(productId);
                    showToast('Added to Wishlist!');
                } else {
                    // Remove from wishlist
                    wishlist = wishlist.filter(id => id !== productId);
                    showToast('Removed from Wishlist!');
                }
                saveState();
                
                // Re-render product grids if visible to update hearts
                rerenderVisibleProductGrids();
            }
            
            /**
             * Toggles the active class on a wishlist button.
             */
            function updateWishlistHeart(buttonEl, productId) {
                 if (wishlist.includes(productId.toString())) {
                    buttonEl.classList.add('active');
                    if(buttonEl.id === 'detail-add-to-wishlist-btn') buttonEl.textContent = '‚ù§ Added to Wishlist';
                } else {
                    buttonEl.classList.remove('active');
                    if(buttonEl.id === 'detail-add-to-wishlist-btn') buttonEl.textContent = '‚ù§ Add to Wishlist';
                }
            }

            /**
             * Adds/Removes a product to/from the compare list.
             * @param {string|number} productId - The ID of the product.
             */
            function addToCompare(productId) {
                productId = productId.toString();
                if (!compareList.includes(productId)) {
                    if (compareList.length >= 3) {
                        showToast('You can only compare up to 3 items. Please remove one first.');
                    } else {
                        compareList.push(productId);
                        showToast('Added to Compare List!');
                    }
                } else {
                    compareList = compareList.filter(id => id !== productId);
                    showToast('Removed from Compare List!');
                }
                saveState();
            }
            
            /**
             * Handles country change to update tax and CC validation.
             */
            function handleCountryChange(e) {
                const country = e.target.value;
                // Simple dummy logic for tax and CC
                switch(country) {
                    case 'Canada':
                        taxRate = 0.13;
                        checkoutCardInput.placeholder = 'e.g., 15 digits (AMEX)';
                        checkoutCardInput.pattern = '\\d{15,16}';
                        checkoutCardInput.title = '15-16 digit card number';
                        break;
                    case 'India':
                        taxRate = 0.18;
                        checkoutCardInput.placeholder = 'e.g., 16 digits + CVV';
                        checkoutCardInput.pattern = '\\d{16}';
                        checkoutCardInput.title = '16 digit card number';
                        break;
                    case 'US':
                        taxRate = 0.05;
                        checkoutCardInput.placeholder = 'e.g., 16 digits';
                        checkoutCardInput.pattern = '\\d{16}';
                        checkoutCardInput.title = '16 digit card number';
                        break;
                    default:
                        taxRate = 0.07;
                        checkoutCardInput.placeholder = 'e.g., 16 digits';
                        checkoutCardInput.pattern = '\\d{16}';
                        checkoutCardInput.title = '16 digit card number';
                }
                
                showToast(`Tax rate updated to ${(taxRate * 100).toFixed(0)}% for ${country}`);
                
                // Re-render cart if visible to show new tax
                if (!document.getElementById('page-cart').classList.contains('hidden')) {
                    renderCart();
                }
            }
            
            /**
             * Handles the checkout form submission.
             * @param {Event} e - The form submit event.
             */
            function handleCheckout(e) {
                e.preventDefault();
                
                // Basic validation
                let isValid = true;
                const fields = [
                    { id: 'checkout-name', errorId: 'name-error', validator: (val) => val.trim() !== '' },
                    { id: 'checkout-email', errorId: 'email-error', validator: (val) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(val) },
                    { id: 'checkout-address', errorId: 'address-error', validator: (val) => val.trim() !== '' },
                    { id: 'checkout-country', errorId: 'country-error', validator: (val) => val.trim() !== '' },
                    { id: 'checkout-card', errorId: 'card-error', validator: (val) => new RegExp(checkoutCardInput.pattern).test(val) }
                ];
                
                // Billing address validation (if visible)
                const isBillingVisible = !billingSameAsShippingCheck.checked;
                const billingFields = [
                    { id: 'billing-name', errorId: 'billing-name-error', validator: (val) => val.trim() !== '' },
                    { id: 'billing-address', errorId: 'billing-address-error', validator: (val) => val.trim() !== '' }
                ];

                // Hide all errors
                [...fields, ...billingFields].forEach(f => {
                    document.getElementById(f.errorId).style.display = 'none';
                    document.getElementById(f.id).classList.remove('invalid');
                });

                fields.forEach(f => {
                    const fieldEl = document.getElementById(f.id);
                    if (!f.validator(fieldEl.value)) {
                        document.getElementById(f.errorId).style.display = 'block';
                        fieldEl.classList.add('invalid');
                        isValid = false;
                    }
                });
                
                if (isBillingVisible) {
                    billingFields.forEach(f => {
                        const fieldEl = document.getElementById(f.id);
                        if (!f.validator(fieldEl.value)) {
                            document.getElementById(f.errorId).style.display = 'block';
                            fieldEl.classList.add('invalid');
                            isValid = false;
                        }
                    });
                }

                if (isValid) {
                    // Simulate order processing
                    setTimeout(() => {
                        const orderNumber = `QA-${Date.now().toString().slice(-6)}`;
                        document.getElementById('order-number-display').textContent = `Your Order Number: ${orderNumber}`;
                        
                        // Clear cart and discount
                        cart = [];
                        appliedCoupon = null;
                        discountAmount = 0;
                        saveState();
                        updateCartSummary();
                        
                        // Reset form
                        checkoutForm.reset();
                        billingAddressGroup.classList.add('hidden'); // Re-hide billing
                        
                        // Show success message
                        window.location.hash = 'success';
                    }, 1000); // Simulate network delay
                }
            }
            
            /**
             * Handles the signup form submission.
             */
            function handleSignup(e) {
                e.preventDefault();
                let isValid = true;
                
                // Get fields
                const nameEl = document.getElementById('signup-name');
                const emailEl = document.getElementById('signup-email');
                const passEl = document.getElementById('signup-password');
                const confirmEl = document.getElementById('signup-password-confirm');
                
                // Get error fields
                const nameErr = document.getElementById('signup-name-error');
                const emailErr = document.getElementById('signup-email-error');
                const passErr = document.getElementById('signup-password-error');
                const confirmErr = document.getElementById('signup-password-confirm-error');
                
                // Reset errors
                [nameErr, emailErr, passErr, confirmErr].forEach(err => err.style.display = 'none');
                [nameEl, emailEl, passEl, confirmEl].forEach(el => el.classList.remove('invalid'));

                // Validate Name
                if (nameEl.value.trim() === '') {
                    nameErr.style.display = 'block';
                    nameEl.classList.add('invalid');
                    isValid = false;
                }
                
                // Validate Email
                if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailEl.value)) {
                    emailErr.style.display = 'block';
                    emailErr.textContent = 'A valid email is required.';
                    emailEl.classList.add('invalid');
                    isValid = false;
                } else if (users.find(u => u.email === emailEl.value)) {
                    emailErr.style.display = 'block';
                    emailErr.textContent = 'This email is already registered.';
                    emailEl.classList.add('invalid');
                    isValid = false;
                }
                
                // Validate Password
                if (passEl.value.length < 6) {
                    passErr.style.display = 'block';
                    passEl.classList.add('invalid');
                    isValid = false;
                }
                
                // Validate Confirm Password
                if (passEl.value !== confirmEl.value) {
                    confirmErr.style.display = 'block';
                    confirmEl.classList.add('invalid');
                    isValid = false;
                }
                
                if (isValid) {
                    // Add new user
                    users.push({
                        name: nameEl.value.trim(),
                        email: emailEl.value.trim(),
                        password: passEl.value // In a real app, HASH THIS!
                    });
                    saveState();
                    showToast('Account created successfully! Please log in.');
                    signupForm.reset();
                    window.location.hash = 'login';
                }
            }
            
            /**
             * Handles the login form submission.
             */
            function handleLogin(e) {
                e.preventDefault();
                
                const emailEl = document.getElementById('login-email');
                const passEl = document.getElementById('login-password');
                const emailError = document.getElementById('login-email-error');
                const passError = document.getElementById('login-password-error');
                
                emailError.style.display = 'none';
                passError.style.display = 'none';
                emailEl.classList.remove('invalid');
                passEl.classList.remove('invalid');
                
                const user = users.find(u => u.email === emailEl.value && u.password === passEl.value);
                
                if (user) {
                    isLoggedIn = true;
                    currentUser = user;
                    saveState();
                    updateNav();
                    loginForm.reset();
                    window.location.hash = 'account';
                    showToast('Login Successful!');
                } else {
                    emailError.style.display = 'block';
                    emailError.textContent = 'Invalid email or password.';
                    emailEl.classList.add('invalid');
                    passEl.classList.add('invalid');
                }
            }
            
            /**
             * Handles logout.
             */
            function handleLogout() {
                isLoggedIn = false;
                currentUser = null;
                wishlist = [];
                compareList = [];
                appliedCoupon = null;
                discountAmount = 0;
                
                saveState();
                updateNav();
                
                // Force re-render of any visible product grids to remove wishlist hearts
                rerenderVisibleProductGrids();
                
                window.location.hash = 'home';
                showToast('You have been logged out.');
            }
            
            /**
             * Re-renders all potentially visible product grids to update UI state (e.g., wishlist icons).
             */
            function rerenderVisibleProductGrids() {
                if (!document.getElementById('page-home').classList.contains('hidden')) {
                    renderHomeSections();
                }
                if (!document.getElementById('page-products').classList.contains('hidden')) {
                    applyFilters();
                }
                if (!document.getElementById('page-category-products').classList.contains('hidden')) {
                    const categoryName = document.getElementById('category-products-title').textContent.replace('Category: ', '');
                    if (categoryName) showCategoryProducts(categoryName);
                }
                if (!document.getElementById('page-product-detail').classList.contains('hidden')) {
                    const productId = detailAddToCartBtn.dataset.id;
                    if (productId) showProductDetail(productId);
                }
                 if (!document.getElementById('page-wishlist').classList.contains('hidden')) {
                    renderWishlistPage();
                }
                 if (!document.getElementById('page-compare').classList.contains('hidden')) {
                    renderComparePage();
                }
            }
            
            /**
             * Updates the cart count icon and mini cart dropdown.
             * @param {boolean} [showDropdown=false] - Whether to briefly show the dropdown.
             */
            function updateCartSummary(showDropdown = false) {
                const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
                
                // Update Count
                if (totalItems > 0) {
                    cartCountEl.textContent = totalItems;
                    cartCountEl.style.display = 'block';
                } else {
                    cartCountEl.style.display = 'none';
                }
                
                // Update Dropdown
                let subtotal = 0;
                if (cart.length === 0) {
                    miniCartItemsEl.innerHTML = '<p>Your cart is empty.</p>';
                } else {
                    miniCartItemsEl.innerHTML = '';
                    // Show last 2 items
                    cart.slice(-2).reverse().forEach(item => {
                        const product = getProductById(item.id);
                        if (product) {
                            miniCartItemsEl.innerHTML += `
                                <div class="mini-cart-item">
                                    <img src="${product.image.replace('600x400', '100x100')}" alt="${product.name}">
                                    <div class="mini-cart-item-info">
                                        <div class="name">${product.name}</div>
                                        <div>${item.quantity} x $${product.price.toFixed(2)}</div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    if (cart.length > 2) {
                         miniCartItemsEl.innerHTML += `<p style="text-align: center; font-size: 0.9rem;">...and ${cart.length - 2} more items.</p>`;
                    }
                    // Recalculate full subtotal for summary
                    subtotal = calculateSubtotal();
                }
                
                miniCartSubtotalEl.textContent = `$${subtotal.toFixed(2)}`;
                
                if (showDropdown && !document.getElementById('page-cart').classList.contains('hidden')) {
                    // Don't show dropdown if we're already on the cart page
                    showDropdown = false;
                }
                
                if (showDropdown) {
                    miniCartToggle.classList.add('open');
                    setTimeout(() => {
                         miniCartToggle.classList.remove('open');
                    }, 3000);
                }
            }

            /**
             * Saves the app state to localStorage.
             */
            function saveState() {
                localStorage.setItem('qaTestStoreState', JSON.stringify({
                    users,
                    cart,
                    wishlist,
                    compareList,
                    isLoggedIn,
                    currentUser,
                    appliedCoupon,
                    discountAmount
                }));
            }

            /**
             * Loads the app state from localStorage.
             */
            function loadState() {
                const savedState = localStorage.getItem('qaTestStoreState');
                if (savedState) {
                    const state = JSON.parse(savedState);
                    users = state.users || [];
                    cart = state.cart || [];
                    wishlist = state.wishlist || [];
                    compareList = state.compareList || [];
                    isLoggedIn = state.isLoggedIn || false;
                    currentUser = state.currentUser || null;
                    appliedCoupon = state.appliedCoupon || null;
                    // Recalculate discount based on saved coupon and current cart
                    if (appliedCoupon === couponCode) {
                        discountAmount = calculateSubtotal() * couponDiscount;
                    } else {
                        discountAmount = 0;
                    }
                }
                // Do not load currentSearchTerm, as it's not saved
                updateCartSummary();
                updateNav();
            }
            
            /**
             * Shows a toast notification.
             * @param {string} message - The message to display.
             */
            function showToast(message) {
                toastEl.textContent = message;
                toastEl.classList.add('show');
                setTimeout(() => {
                    toastEl.classList.remove('show');
                }, 3000);
            }
            
            /**
             * Shows the confirmation modal.
             * @param {string} message - The message to display.
             * @param {Function} onConfirm - The callback to run if confirmed.
             * @param {string} [title='Are you sure?'] - Optional modal title.
             */
            function showConfirmationModal(message, onConfirm, title = 'Are you sure?') {
                modalTitle.textContent = title;
                modalMessage.textContent = message;
                currentModalConfirmCallback = onConfirm || (() => {});
                modal.style.display = 'flex';
            }
            
            /**
             * Hides the confirmation modal.
             */
            function hideConfirmationModal() {
                modal.style.display = 'none';
                currentModalConfirmCallback = () => {};
            }

            // --- START THE APP ---
            init();
        });
    </script>
</body>
</html>
